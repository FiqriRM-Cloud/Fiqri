<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Laporan Transaksi - Warkas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#1976d2">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="apple-touch-icon" href="icons/Warkas192.png">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f8f9fa; }
    .laporan-container {
      max-width: 600px;
      margin: 40px auto;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.08);
      padding: 20px;
    }
    .laporan-header {
      text-align: center;
      margin-bottom: 20px;
    }
    @media (max-width: 600px) {
      .laporan-container { margin: 10px; padding: 10px; }
      .laporan-header h2 { font-size: 1.2rem; }
      table { font-size: 0.9rem; }
    }
    .logo-warkas {
      width: 40px;
      height: 40px;
    }
  </style>
</head>
<body>
  <div class="laporan-container">
    <div class="laporan-header">
      <img src="icons/Warkas.png" alt="Logo Warkas" class="logo-warkas">
      <h2>Laporan Transaksi</h2>
    </div>
    <div id="riwayat-transaksi">
      <!-- Tabel laporan akan diisi oleh laporan.js -->
    </div>
    <a href="dashboard.html" class="btn btn-secondary mt-3">
        <i class="fas fa-arrow-left me-2"></i>Kembali ke Dashboard
    </a>
    <!-- Tambahkan tombol sinkron di laporan.html -->
    <button class="btn btn-success mt-2" onclick="sinkronLaporan()">Sinkron Laporan</button>
  </div>
  <script src="laporan.js"></script>
  <!-- Konten halaman -->
<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js');
}

function sinkronLaporan() {
    if (!navigator.onLine) {
        alert('Sinkronisasi hanya bisa dilakukan saat online!');
        return;
    }

    const request = indexedDB.open("WarKasDB", 2);
    request.onsuccess = (event) => {
        const db = event.target.result;
        const tx = db.transaction("transaksi", "readonly");
        const store = tx.objectStore("transaksi");
        const req = store.getAll();

        req.onsuccess = () => {
            const data = req.result;
            // Kirim ke server (URL backend lokal)
            fetch('http://localhost:3000/api/sinkron-laporan', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(res => res.json())
            .then(resData => {
                if (resData.success) {
                    alert('Sinkronisasi berhasil!');
                } else {
                    alert('Sinkronisasi gagal di server!');
                }
            })
            .catch(() => alert('Gagal terhubung ke server!'));
        };
    };
}
</script>
</body>
</html>


